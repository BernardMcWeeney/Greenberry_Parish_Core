(()=>{"use strict";const t=window.wp.blocks,e=window.wp.coreData,o=window.wp.editor,n=window.wp.richText,s=new Map,r=new Map;let i=new Map,c=0;const p=t=>"string"==typeof t&&t.startsWith("parish_"),u=t=>{return"string"==typeof t?t:t&&"object"==typeof t&&null!==(e=t?.args?.key)&&void 0!==e?e:null;var e},l=(t,e)=>{var n,s;const r=e(o.store);return{postType:null!==(n=t?.postType)&&void 0!==n?n:r?.getCurrentPostType?.(),postId:null!==(s=t?.postId)&&void 0!==s?s:r?.getCurrentPostId?.()}},a=t=>{if(void 0!==t)return null===t||""===t?"":"string"==typeof t?t:"number"==typeof t||"boolean"==typeof t?String(t):(0,n.isRichTextValue)(t)?(0,n.toHTMLString)({value:t}):t&&"string"==typeof t.text?t.text:t&&"string"==typeof t.value?t.value:""};(0,t.registerBlockBindingsSource)({name:"parish/post-meta",usesContext:["postType","postId"],getValues({select:t,context:o,bindings:n}){const s={};if(!n||"object"!=typeof n)return s;const{postType:r,postId:a}=l(o,t);if(!r||!a)return s;const d=`${r}:${a}`,f=Date.now();f-c>50&&(i.clear(),c=f);let y=i.get(d);if(!y){const o=t(e.store).getEditedEntityRecord("postType",r,a);y=o?.meta||{},i.set(d,y)}for(const[t,e]of Object.entries(n)){const o=u(e);if(!p(o))continue;const n=y[o];s[t]=null!=n?n:""}return s},setValues({select:t,dispatch:o,context:n,bindings:i}){if(!i||"object"!=typeof i)return;const{postType:c,postId:d}=l(n,t);if(!c||!d)return;const f=`${c}:${d}`;for(const[,t]of Object.entries(i)){const e=u(t);if(!p(e))continue;const o=t?.newValue,n=a(o);if(void 0===n)continue;const r=s.get(f)||{};r[e]=n,s.set(f,r)}const y=r.get(f);y&&clearTimeout(y);const g=setTimeout(()=>{const t=s.get(f);s.delete(f),r.delete(f),t&&0!==Object.keys(t).length&&o(e.store).editEntityRecord("postType",c,d,{meta:t})},150);r.set(f,g)},canUserEditValue({select:t,context:e,args:o}){const{postType:n,postId:s}=l(e,t);if(!n||!s)return!1;if(!String(n).startsWith("parish_"))return!1;const r=o?.key;return p(r)}})})();