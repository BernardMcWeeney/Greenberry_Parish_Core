(()=>{"use strict";const t=window.wp.blocks,e=window.wp.coreData,o=window.wp.editor,s=window.wp.richText,n=new Map,r=new Map;let i=new Map,c=0;const p=t=>"string"==typeof t&&t.startsWith("parish_"),u=t=>"string"==typeof t?t:t&&"object"==typeof t?t?.args?.key??null:null,a=(t,e)=>{const s=e(o.store);return{postType:t?.postType??s?.getCurrentPostType?.(),postId:t?.postId??s?.getCurrentPostId?.()}},l=t=>{if(void 0!==t)return null===t||""===t?"":"string"==typeof t?t:"number"==typeof t||"boolean"==typeof t?String(t):(0,s.isRichTextValue)(t)?(0,s.toHTMLString)({value:t}):t&&"string"==typeof t.text?t.text:t&&"string"==typeof t.value?t.value:""};(0,t.registerBlockBindingsSource)({name:"parish/post-meta",usesContext:["postType","postId"],getValues({select:t,context:o,bindings:s}){const n={};if(!s||"object"!=typeof s)return n;const{postType:r,postId:l}=a(o,t);if(!r||!l)return n;const d=`${r}:${l}`,f=Date.now();f-c>50&&(i.clear(),c=f);let y=i.get(d);if(!y){const o=t(e.store).getEditedEntityRecord("postType",r,l);y=o?.meta||{},i.set(d,y)}for(const[t,e]of Object.entries(s)){const o=u(e);if(!p(o))continue;const s=y[o];n[t]=s??""}return n},setValues({select:t,dispatch:o,context:s,bindings:i}){if(!i||"object"!=typeof i)return;const{postType:c,postId:d}=a(s,t);if(!c||!d)return;const f=`${c}:${d}`;for(const[,t]of Object.entries(i)){const e=u(t);if(!p(e))continue;const o=t?.newValue,s=l(o);if(void 0===s)continue;const r=n.get(f)||{};r[e]=s,n.set(f,r)}const y=r.get(f);y&&clearTimeout(y);const g=setTimeout(()=>{const t=n.get(f);n.delete(f),r.delete(f),t&&0!==Object.keys(t).length&&o(e.store).editEntityRecord("postType",c,d,{meta:t})},150);r.set(f,g)},canUserEditValue({select:t,context:e,args:o}){const{postType:s,postId:n}=a(e,t);if(!s||!n)return!1;if(!String(s).startsWith("parish_"))return!1;const r=o?.key;return p(r)}})})();